# A script I use on the Mac to help manage multiple build environments.
# This allows working with the released version and also testing using
# the current SourceForge trunk. (Use svn to manage that)
#
# This will clean and configure the build directory for a wxWidget build.
# (I put this script in my home dir)

export BUILDDIR
export DEBUG
export LIBRARIES
export VERSION=
export WXWIN=
USAGE="Usage $0 trunk|2.8 [debug|release] [carbon]"

if test "x$1" = "xtrunk"; then
	WXWIN=~/wx/trunk
	VERSION="--disable-compat28"
elif test "x$1" = "x2.8"; then
	WXWIN=~/wx/wxWidgets-2.8.12
	VERSION="--disable-compat26"
else
	echo $USAGE
	exit
fi
BUILDDIR="$WXWIN/build"

if test "x$3" = "xcarbon"; then
	BUILDDIR+="-carbon"
else
	BUILDDIR+="-cocoa"
fi

if test "x$2" = "xdebug"; then
	DEBUG="--enable-debug --enable-debug_gdb"
	BUILDDIR+="-debug"
elif test "x$2" = "xrelease"; then
	DEBUG="--disable-debug_flag"
else
	$0 $1 debug
	$0 $1 release
	exit
fi

rm -rf $BUILDDIR
mkdir $BUILDDIR
cd $BUILDDIR

# Note, trunk no longer supports 10.4
if test "x$1" = "xtrunk"; then
	if test -d /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX10.8.sdk
	then
		MINSDK="--with-macosx-version-min=10.5 --with-macosx-sdk=/Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX10.8.sdk --enable-macosx_arch=i386"
	else
		COMPILERS="CC=gcc-4.2 CXX=g++-4.2 LD=g++-4.2"
		MINSDK="--with-macosx-version-min=10.5 --with-macosx-sdk=/Developer/SDKs/MacOSX10.5.sdk --enable-macosx_arch=i386"
	fi

	if test "x$3" = "xcarbon"; then
		MINSDK+=" --with-osx_carbon"
	else
		MINSDK+=" --with-osx_cocoa"
	fi
else
	if test -d /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX10.8.sdk
	then
		MINSDK="--with-macosx-version-min=10.5 --with-macosx-sdk=/Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX10.8.sdk --enable-macosx_arch=i386"
	else
		COMPILERS="CC=gcc-4.0 CXX=g++-4.0 LD=g++-4.0"
		MINSDK="--with-macosx-version-min=10.4 --with-macosx-sdk=/Developer/SDKs/MacOSX10.4u.sdk --enable-macosx_arch=i386"
	fi
fi

LIBRARIES="--with-expat=builtin --with-regex=builtin --with-zlib=builtin --with-libiconv=no"

echo "../configure $COMPILERS --disable-shared --enable-unicode $DEBUG $VERSION $LIBRARIES $MINSDK"

../configure $COMPILERS --disable-shared --enable-unicode $DEBUG $VERSION $LIBRARIES $MINSDK
